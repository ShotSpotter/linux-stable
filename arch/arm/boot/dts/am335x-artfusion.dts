/*
 * Copyright (C) 2012 Texas Instruments Incorporated - http://www.ti.com/
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License version 2 as
 * published by the Free Software Foundation.
 */
/dts-v1/;

#include "am33xx.dtsi"
#include "am335x-bone-common.dtsi"
#include "dt-bindings/mfd/arizona.h"

/ {
	model = "TI AM335x BeagleBone Black";
	compatible = "ti,am335x-bone-black", "ti,am335x-bone", "ti,am33xx";


leds {
pinctrl-names = "default";
pinctrl-0 = <&artfusion_gpio_pins_default>;
compatible = "gpio-leds";

led@1 {
        label = "clockcontrol";
  gpios = <&gpio1 27 GPIO_ACTIVE_HIGH>;
    default-state = "on";
      };


led@2 {
  label = "clockcontroltest";
  gpios = <&gpio1 17 GPIO_ACTIVE_HIGH>;
    default-state = "on";
      };
};


ldo18: ldo18 {
      compatible = "regulator-fixed";
      regulator-name = "DC_1V8";
      regulator-min-microvolt = <1800000>;
      regulator-max-microvolt = <1800000>;
      enable-active-high;
      regulator-always-on;
        };

ldo50: ldo50 { /* BBB VCC_5V */
      compatible = "regulator-fixed";
      regulator-name = "DC_5V0";
      regulator-min-microvolt = <5000000>;
      regulator-max-microvolt = <5000000>;
      enable-active-high;
      regulator-always-on;
        };


ldo_wlf5102: ldo_wlf5102 {
	compatible = "regulator-gpio";
	regulator-name = "LDO_WLF5102";
	regulator-min-microvolt = <1800000>;
	regulator-max-microvolt = <1800000>;
	enable-active-high;
	regulator-always-on;
	enable-gpio = <&gpio1 29 GPIO_ACTIVE_HIGH>;
        /*wlf,ldoena = <&gpio1 29 GPIO_ACTIVE_HIGH>; /* allow LDOENA wm5102 by driver */
};


clk_audio_fixed: clk_audio_fixed {
      #clock-cells = <0>;
      compatible = "fixed-clock";
      clock-frequency = <24576000>;
};


clk_audio: clk_audio {
      #clock-cells = <0>;
      compatible = "gpio-gate-clock";
      clocks = <&clk_audio_fixed>;
      enable-gpios = <&gpio1 27 0>; /* BeagleBone Black Clk enable on GPIO1_27 */
};


sound {
    status = "okay";
    compatible = "simple-audio-card";
    simple-audio-card,name = "WM5102";
    simple-audio-card,widgets =
        "Line", "Line In";
    simple-audio-card,routing =
				 "IN1L", "Line In",
				 "IN1R", "Line In",
				 "IN2L", "Line In",
				 "IN2R", "Line In",
				 "IN3L", "Line In",
				 "IN3R", "Line In";
    simple-audio-card,dai-link {
	format = "dsp_b";
	bitclock-master = <&sound_master>;
	frame-master = <&sound_master>;
	cpu {
		sound-dai = <&mcasp0>;
		/*
		dai-tdm-slot-num = <6>;
		dai-tdm-slot-width = <32>;
		*/
	};
	sound_master: codec {
		sound-dai = <&wm5102>;
		clocks = <&clk_audio>;
		/*
		dai-tdm-slot-num = <6>;
		dai-tdm-slot-width = <32>;
		*/
	};
    };

};





};

&ldo3_reg {
	regulator-min-microvolt = <1800000>;
	regulator-max-microvolt = <1800000>;
	regulator-always-on;
};

&mmc1 {
	vmmc-supply = <&vmmcsd_fixed>;
};

&mmc2 {
	vmmc-supply = <&vmmcsd_fixed>;
	pinctrl-names = "default";
	pinctrl-0 = <&emmc_pins>;
	bus-width = <8>;
	status = "okay";
};

&am33xx_pinmux {
	nxp_hdmi_bonelt_pins: nxp_hdmi_bonelt_pins {
		pinctrl-single,pins = <
			0x1b0 0x03      /* xdma_event_intr0, OMAP_MUX_MODE3 | AM33XX_PIN_OUTPUT */
			0xa0 0x08       /* lcd_data0.lcd_data0, OMAP_MUX_MODE0 | AM33XX_PIN_OUTPUT | AM33XX_PULL_DISA */
			0xa4 0x08       /* lcd_data1.lcd_data1, OMAP_MUX_MODE0 | AM33XX_PIN_OUTPUT | AM33XX_PULL_DISA */
			0xa8 0x08       /* lcd_data2.lcd_data2, OMAP_MUX_MODE0 | AM33XX_PIN_OUTPUT | AM33XX_PULL_DISA */
			0xac 0x08       /* lcd_data3.lcd_data3, OMAP_MUX_MODE0 | AM33XX_PIN_OUTPUT | AM33XX_PULL_DISA */
			0xb0 0x08       /* lcd_data4.lcd_data4, OMAP_MUX_MODE0 | AM33XX_PIN_OUTPUT | AM33XX_PULL_DISA */
			0xb4 0x08       /* lcd_data5.lcd_data5, OMAP_MUX_MODE0 | AM33XX_PIN_OUTPUT | AM33XX_PULL_DISA */
			0xb8 0x08       /* lcd_data6.lcd_data6, OMAP_MUX_MODE0 | AM33XX_PIN_OUTPUT | AM33XX_PULL_DISA */
			0xbc 0x08       /* lcd_data7.lcd_data7, OMAP_MUX_MODE0 | AM33XX_PIN_OUTPUT | AM33XX_PULL_DISA */
			0xc0 0x08       /* lcd_data8.lcd_data8, OMAP_MUX_MODE0 | AM33XX_PIN_OUTPUT | AM33XX_PULL_DISA */
			0xc4 0x08       /* lcd_data9.lcd_data9, OMAP_MUX_MODE0 | AM33XX_PIN_OUTPUT | AM33XX_PULL_DISA */
			0xc8 0x08       /* lcd_data10.lcd_data10, OMAP_MUX_MODE0 | AM33XX_PIN_OUTPUT | AM33XX_PULL_DISA */
			0xcc 0x08       /* lcd_data11.lcd_data11, OMAP_MUX_MODE0 | AM33XX_PIN_OUTPUT | AM33XX_PULL_DISA */
			0xd0 0x08       /* lcd_data12.lcd_data12, OMAP_MUX_MODE0 | AM33XX_PIN_OUTPUT | AM33XX_PULL_DISA */
			0xd4 0x08       /* lcd_data13.lcd_data13, OMAP_MUX_MODE0 | AM33XX_PIN_OUTPUT | AM33XX_PULL_DISA */
			0xd8 0x08       /* lcd_data14.lcd_data14, OMAP_MUX_MODE0 | AM33XX_PIN_OUTPUT | AM33XX_PULL_DISA */
			0xdc 0x08       /* lcd_data15.lcd_data15, OMAP_MUX_MODE0 | AM33XX_PIN_OUTPUT | AM33XX_PULL_DISA */
			0xe0 0x00       /* lcd_vsync.lcd_vsync, OMAP_MUX_MODE0 | AM33XX_PIN_OUTPUT */
			0xe4 0x00       /* lcd_hsync.lcd_hsync, OMAP_MUX_MODE0 | AM33XX_PIN_OUTPUT */
			0xe8 0x00       /* lcd_pclk.lcd_pclk, OMAP_MUX_MODE0 | AM33XX_PIN_OUTPUT */
			0xec 0x00       /* lcd_ac_bias_en.lcd_ac_bias_en, OMAP_MUX_MODE0 | AM33XX_PIN_OUTPUT */
		>;
	};
	nxp_hdmi_bonelt_off_pins: nxp_hdmi_bonelt_off_pins {
		pinctrl-single,pins = <
			0x1b0 0x03      /* xdma_event_intr0, OMAP_MUX_MODE3 | AM33XX_PIN_OUTPUT */
		>;
	};


artfusion_gpio_pins_default: artfusion_gpio_pins_default {
pinctrl-single,pins = <
0x164 ( PIN_INPUT | MUX_MODE7 ) /* (C18) eCAP0_in_PWM0_out.gpio0[7] */
0x44 ( PIN_OUTPUT | MUX_MODE7 ) /* (V14) gpmc_a1.gpio1[17] */
0x6c ( PIN_OUTPUT_PULLUP | MUX_MODE7 ) /* (V17) gpio1[27] 24.576MHz clock OE*/
0x1ac ( PIN_INPUT_PULLUP | MUX_MODE7 ) /* (A14) mcasp0_ahclkx.gpio3[21] */
0x7c ( PIN_OUTPUT_PULLUP | MUX_MODE7 ) /* (V6) gpmc_csn0.gpio1[29] WM5012-LDOEN */
>;
};


mcasp0_slave_pins_default: mcasp0_slave_pins_default {
pinctrl-single,pins = <
0x1a0 ( PIN_INPUT | MUX_MODE0 ) /* (B12) mcasp0_aclkr.mcasp0_aclkr */
0x1a4 ( PIN_INPUT | MUX_MODE0 ) /* (C13) mcasp0_fsr.mcasp0_fsr */
0x198 ( PIN_INPUT | MUX_MODE0 ) /* (D12) mcasp0_axr0.mcasp0_axr0 */
0x19c ( PIN_OUTPUT | MUX_MODE2 ) /* (C12) mcasp0_ahclkr.mcasp0_axr2 */
>;
};


wm5102_i2c_pins_default: wm5102_i2c_pins_default {
pinctrl-single,pins = <
0x15c ( PIN_INPUT | MUX_MODE2 ) /* (A16) spi0_cs0.I2C1_SCL */
0x158 ( PIN_INPUT | MUX_MODE2 ) /* (B16) spi0_d1.I2C1_SDA */
0x78 ( PIN_OUTPUT_PULLUP | MUX_MODE7 ) /* (U18) gpmc_be1n.gpio1[28] /RESET but we have an inveter */
>;
};



};

&lcdc {
	status = "okay";
	port {
		lcdc_0: endpoint@0 {
			remote-endpoint = <&hdmi_0>;
		};
	};
};

&i2c0 {
	tda19988 {
		compatible = "nxp,tda998x";
		reg = <0x70>;
		pinctrl-names = "default", "off";
		pinctrl-0 = <&nxp_hdmi_bonelt_pins>;
		pinctrl-1 = <&nxp_hdmi_bonelt_off_pins>;

		port {
			hdmi_0: endpoint@0 {
				remote-endpoint = <&lcdc_0>;
			};
		};
	};
};


&i2c1 {
      pinctrl-names = "default";
      pintctrl-0 = <&wm5102_i2c_pins_default>;
      status = "okay";
      clock-frequency = <400000>;


      wm5102: wm5102@1a {
      	      compatible = "wlf,wm5102";
	      reg = <0x1a>;
	      status = "okay";
	      /* /IRQ is connected to GPIO2_23. Mask from HiassofT DT for cirrus audio board */
	      interrupts = <23 8>;
	      interrupt-controller;
	      #interrupt-cells = <2>;
	      interrupt-parent = <&gpio2>;
	      gpio-controller;
	      #gpio-cells = <2>;
	      wlf,gpio-defaults = <
		ARIZONA_GP_FN_TXLRCLK
		ARIZONA_GP_DEFAULT
		ARIZONA_GP_DEFAULT
		ARIZONA_GP_DEFAULT
		ARIZONA_GP_DEFAULT
		>;
	      wlf,reset = <&gpio1 28 GPIO_ACTIVE_HIGH>; /* allow /RESET wm5102 by driver (via inverter)*/
              wlf,ldoena = <&gpio1 29 GPIO_ACTIVE_HIGH>; /* allow LDOENA wm5102 by driver */
	      LDOVDD-supply  = <&ldo18>; /* fixed 1V8 regulator */
	      AVDD-supply    = <&ldo18>;
	      DBVDD1-supply  = <&ldo18>;
	      DBVDD2-supply  = <&ldo18>;
	      DBVDD3-supply  = <&ldo18>;
	      CPVDD-supply   = <&ldo18>;
	      DCVDD-supply   = <&ldo50>;
	      SPKVDDL-supply = <&ldo50>; /* fixed VDD_5V from BBB */
	      SPKVDDR-supply = <&ldo50>;
              #sound-dai-cells = <0>;
      };

};


&mcasp0 {
        pinctrl-names = "default";
        pinctrl-0 = <&mcasp0_slave_pins_default>;

        status = "okay";

        op-mode = <0>;          /* MCASP_IIS_MODE */
	tdm-slots = <6>;
        /* 4 serializers */
        serial-dir = <  /* 0: INACTIVE, 1: TX, 2: RX - 0 2 0 0 */
                2 0 0 0
        >;
        tx-num-evt = <32>;
        rx-num-evt = <32>;
        #sound-dai-cells = <0>;
};


&rtc {
	system-power-controller;
};
